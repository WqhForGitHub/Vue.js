# 7.1 patch 介绍



## 1. 新增节点

​      





# 7.4 更新节点                                               



## 1. 静态节点

什么是静态节点？**`静态节点指的是那些一旦渲染到界面上之后，无论日后状态如何变化，都不会发生任何变化的节点`**                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         。例如：

```html
<p>我是静态节点，我不需要发生变化</p>
```



## 2. 新虚拟节点有文本属性                                                                                                                      

vnode 和 oldVnode 不是静态节点，并且有不同的属性时，要以 vnode 为准来更新视图。根据 vnode 是否有 text 属性，更新节点可以分为两种不同的情况。

如果 vnode 有 text 属性，那么不论之前的旧节点的子节点是什么，直接调用 **`setTextContent`**  方法来将视图中 DOM 节点的内容改为 vnode 的 text 属性所保存的文字。                                                                                                                                                                                                                                                                    



## 3. 新虚拟节点无文本属性

如果新创建的虚拟节点没有 text 属性，那么它就是一个 **`元素节点`** 。元素节点通常会有子节点，也就是 children 属性，但也有可能没有子节点，所以存在两种不同的情况。



### 1. 有 children 的情况

#### 1. oldVnode 有 children 属性

详细的对比并更新                                                                                                                                                                 



#### 2. oldVnode 没有 children 属性

oldVnode 要么是一个 **`空标签`** ，要么是有 **`文本的文本节点`** 。如果是文本节点，那么先把文本清空让它变成空标签，然后将 vnode 中的 children 挨个创建成真实的 DOM 元素节点并将其插入到视图中的 DOM 节点下面。                                                                                                                                                                                                                                                             



### 2. 无 children 的情况

当新创建的虚拟节点既没有 text 属性也没有 children 属性时，这说明这个新创建的节点是一个空节点，它下面既没有文本也没有子节点，这时如果 oldVnode 中有子节点就删除子节点，有文本就删除文本。有什么删什么，最后达到视图中是空标签的目的。





# 7.5 更新子节点



## 1. 更新策略



### 1. 创建子节点                      

插入到 oldChildren 中所有未处理节点的前面

### 2. 更新子节点



### 3. 移动子节点



### 4. 删除子节点                                                                                                                                                                                                                                                                 



## 2. 优化策略

  





## 3. 哪些节点是未处理过的

​                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     